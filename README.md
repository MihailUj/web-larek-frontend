# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар
```
export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```


Данные заказа
```
export interface IOrder {
  items: string[];
  total: number;
  payment: string;
  email: string;
  phone: string;
  address: string;
}
```

Данные для хранения списка товаров
```
export interface IProductsData {
  products: IProduct[];
  getProduct(productId: string): IProduct;
}
```

Данные для хранения корзины
```
export interface IBasketData {
  products: IProduct[];
  totalPrice: number;
  counter: number;
  addProduct(productData: IProduct): void;
  deleteProduct(productId: string): void;
  cleanBasket(): void;
  updateCounter(): void;
  updateTotalPrice(): void;
  inBasket(productId: string): boolean;
}
```

Данные для обработки заказа
```
export interface IOrderData{
  products: IProduct[];
  totalPrice: number;
  counter: number;
  addProduct(productData: IProduct): void;
  deleteProduct(productId: string): void;
  cleanBasket(): void;
  updateCounter(): void;
  updateTotalPrice(): void;
  inBasket(productId: string): boolean;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _products: IProduct[] - Массив объектов товаров;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getProduct(productId: string): IProduct - Возвращает данные товара по id;
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий.\

В полях класса хранятся следующие данные:
- products: IProduct[] - Массив объектов товаров корзины;
- totalPrice: number - Общая стоимость товаров в корзине;
- counter: number - Количество товаров в корзине;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(productData: IProduct): void - добавляет один товар в начало массива и создает событие;
- deleteProduct(productId: string): void - удаляет товар из массива и создает событие;
- cleanBasket(): void - полностью очищает корзину товаров и создает событие;
- updateCounter(): void - обновляет счетчик количества товаров;
- updateTotalPrice(): void - обновляет общую стоимость товаров;
- inBasket(productId: string): boolean - проверяет наличие товара в корзине по id;
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\

В полях класса хранятся следующие данные:
- _orders: IOrder[] - список заказов;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет набор методов для взаимодействия с этими данными:
- checkValidation(data: string):boolean - проверяет объект с данными на валидность;
- setFormData(field: string, value: string): void - принимает объект данных поля формы и сохраняет данные;
- setProductsData(productIds: string[], totalPrice: number): void - сохраняет данные информации о товарах корзины и общую стоимость;
- validateOrderForm(): boolean - проверяет валидность данных адреса и способа оплаты;
- validateContactsForm(): boolean - проверяет валидность данных номера телефона и способа оплаты; 
- getOrderInfo(): IOrder: - возвращает данные заказа;


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Отвечает за обработку отображения главной страницы. Реализует сеттеры `locked`, `counter` и `catalog`. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Конструктор, кроме элемента страницы принимает экземпляр `EventEmitter` для инициации событий.\
Поля класса
- _pageWrapper: HTMLElement - элемент отвечающий за закрепление модального окна;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Сеттер locked(value: boolean) - выполняет закрепление модального окна;
Сеттер counter(value: number) - обновляет счетчик корзины;
catalog(items: HTMLElement[]) - устанавливает список продуктов.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(container: HTMLElement, events: IEvents) - Конструктор принимает DOOM элемент контейнера модального окна и инстант брокера событий.

Поля класса
- _content: HTMLElement - элемент содержимого модального окна;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Сеттер content(value: HTMLElement) - принимает элемент содержимого модального окна и сохраняет в _content;

#### Класс Card
Отвечает за отображение карточки товара, задавая название, описание, стоимость, категорию, изображение товара, статус добавления товара в козину. Класс используется для отображения информации о товаре на главной странице, в карточке товара и корзине. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий и название блока, в котором отображается карточка.\
Методы:
- render(data: Partial<IProduct> | undefined, inBasket: boolean, index?: number): HTMLElement - расширяет родительский метод, обрабатывая отдельно наличие индексов продуктов и состояние кнопки, остальные данные передаются в родительский метод. Заполняет атрибуты элементов карточки данными. Метод возвращает разметку карточки с установленными слушателями. Слушатели устанавливаются на все интерактивные элементы карточки и генерируют соответствующие события через экземпляр брокера событий.
- deleteCard(): void - метод для удаления разметки карточки;
- геттер id - Возвращает идентификатор товара.

#### Класс Basket
отвечает за отображение содержимого модального окна корзины товаров. Задает список товаров, общую стоимость товаров в модальном окне. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- render(data: Partial<IBasket>) - расширяет родительский метод. Обрабатывает доступность кнопку перехода к форме заказа, в зависимости от наличия товара в корзине. Метод возвращает полностью заполненную карточку с установленными слушателями для кнопки корзины на главной странице и модального окна;

#### Класс Contacts
Отвечает за отображение содержимого модального окна формы контактной информации пользователя. Задает состояние кнопки подтверждения и отображение сообщения валидации полей. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- resetForm() - Выполняет сброс формы заполнения данных.
- сеттер valid(isValid: boolean) - устанавливает состояние кнопки и отображение сообщения валидации;
- сеттер errorMassage(text: string) - устанавливает сообщение валидации в элемент модального окна.

#### Класс Order
Отвечает за отображение содержимого модального окна формы информации о доставке и способе оплаты. Задает состояние кнопки подтверждения и отображение сообщения валидации полей. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- resetForm() - Выполняет сброс формы заполнения данных.
- сеттер valid(isValid: boolean) - устанавливает состояние кнопки и отображение сообщения валидации;
- сеттер errorMassage(text: string) - устанавливает сообщение валидации в элемент модального окна;
- сеттер payment(paymentMethod: String) - задает отображение состояния кнопок способа оплаты.

#### Класс Success
Отвечает за отображение модального окна успеха оформления заказа. Задает отображение полной стоимости заказа в модальном окне. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- сеттер totalPrice(total: number) - устанавливает отображение стоимости заказа в модальном окне. 


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `basket: changed` - изменение данных корзины
- `products: changed` - изменение массива товаров

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card: select` - выбор товара на главной странице, открытие модального окна карточки товара;
- `order: open` - открытие модального окна корзины;
- `cardPreview: changed` - добавление товара в корзину в модальном окне товара;
- `cardBasket: changed` - удаление товара в модальном окне корзины;
- `order: changed` - изменение состояния полей формы заказа;
- `order: submit` - подтверждение формы заказа;
- `contacts: changed` - изменение состояния полей формы контактной информации;
- `contacts: submit` - подтверждение формы контактной информации; 
- `success: close` - закрытие модального окна успеха;
- `modal: close` - закрытие модального окна;
- `modal: open` - открытие модального окна.

